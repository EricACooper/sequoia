---

engine_initialize:
  - test:
    - test:
       container: tpcc
       command:  "./change_engine.sh  servers:address:0:0 Administrator:password"
       wait: true

create_index:
  - test:
       container: tpcc
       command:  "./run.sh servers:address:0:0:8093 util/cbcrindex.sql"
       wait: true

load_tpcc:
  - test:
        container: tpcc
        command: "python tpcc.py  --duration 7200 --client 100 --warehouses 100  --no-execute n1ql 
                                 --query-url servers:address:0:0:8093 
                                 --userid Administrator --password password --debug n1ql"
        wait: true

load_sabre:
  - test:
        container: testrunner
        command: "python pysystests/tests/n1ql/insert_query.py -doc 5000000 -q servers:address:0:0"
        wait: true

access_phase:
  - test:
        container: testrunner
        command: "pysystests/tests/n1ql/dml_sabre.py -t 1200 -c 1 -q servers:address:0:0 "
        wait: true
  - test:
        container: tpcc
        command: "python tpcc.py   --duration 1200 --warehouses 100 --client 100 --no-load --debug n1ql 
                                 --query-url servers:address:0:0:8093 
                                 --userid Administrator --password password "
        wait: true

failover: #failover
  - test:
      container: couchbase-cli
      command: "failover -c servers:address:0:0 
                --server-failover servers:address:0:2 
                -u  servers:rest_username:0 -p  servers:rest_password:0 
                --force"
      wait: true
  - test:
      container: couchbase-cli
      command:  "rebalance -c  servers:address:0:0
                -u  servers:rest_username:0 -p  servers:rest_password:0"
      wait: true

access_phase:
  - test:
        container: testrunner
        command: "pysystests/tests/n1ql/dml_sabre.py -t 1200 -c 1 -q servers:address:0:0 "
        wait: false
  - test:
        container: tpcc
        command: "python tpcc.py   --duration 1200 --warehouses 100 --client 100 --no-load --debug n1ql 
                                 --query-url servers:address:0:0:8093 
                                 --userid Administrator --password password "
        wait: false

rebalance_in: #rebalance in
  - test:
       container: couchbase-cli
       command: "server-add -c  servers:address:0:0
                 --server-add  servers:address:0:2
                 -u  servers:rest_username:0 -p  servers:rest_password:0
                 --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
       wait: true
  - test:
       container: couchbase-cli
       command:  "rebalance -c  servers:address:0:0
                -u  servers:rest_username:0 -p  servers:rest_password:0"
       wait: true

access_phase:
  - test:
        container: testrunner
        command: "pysystests/tests/n1ql/dml_sabre.py -t 1200 -c 1 -q servers:address:0:0 "
        wait: false
  - test:
        container: tpcc
        command: "python tpcc.py   --duration 1200 --warehouses 100 --client 100 --no-load --debug n1ql 
                                 --query-url servers:address:0:0:8093 
                                 --userid Administrator --password password "
        wait: false

rebalance_out: #rebalance out
  - test:
       container: couchbase-cli
       command:  "rebalance -c  servers:address:0:0 --server-remove=servers:address:0:3:8091
                -u  servers:rest_username:0 -p  servers:rest_password:0"
       wait: true

access_phase:
  - test:
        container: testrunner
        command: "pysystests/tests/n1ql/dml_sabre.py -t 1200 -c 1 -q servers:address:0:0 "
        wait: false
  - test:
        container: tpcc
        command: "python tpcc.py   --duration 1200 --warehouses 100 --client 100 --no-load --debug n1ql 
                                 --query-url servers:address:0:0:8093 
                                 --userid Administrator --password password "
        wait: false

swap_rebalance: #swap rebalance
  - test:
       container: couchbase-cli
       command:  "rebalance -c  servers:address:0:0 --server-remove=servers:address:0:3:8091 --server-add=servers:address:0:4:8091
                -u  servers:rest_username:0 -p  servers:rest_password:0"
       wait: true

access_phase:
  - test:
        container: testrunner
        command: "pysystests/tests/n1ql/dml_sabre.py -t 1200 -c 1 -q servers:address:0:0 "
        wait: false
  - test:
        container: tpcc
        command: "python tpcc.py   --duration 1200 --warehouses 100 --client 100 --no-load --debug n1ql 
                                 --query-url servers:address:0:0:8093 
                                 --userid Administrator --password password "
        wait: false
