###############  create index ################
-
   image: sequoiatools/cbq
   command: "-e=http://{{.QueryNode}}:8093  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_rating on `default`(rating)'"
   wait: true

############### background data loading ################
-
  image: sequoiatools/gideon
  command: "kv --ops {{.Scale 10000}} --create 30 --get 70 --delete 10 --hosts {{.Orchestrator}} --bucket {{.Bucket}}"
  duration: "{{.Scale 60}}"  # 1 minute at scale=1

###############  query index ################
-
  requires: "{{ eq true .DoOnce}}"
  image: sequoiatools/queryloop
  command: "{{.QueryNode}}:8093 'select SUM(rating) from default where rating > 0'"
  concurrency: "{{.Scale 1}}"  # concurrenlty run 5 instances at scale = 1
  duration: "{{.Scale 60}}"    # stop querying after 1 minute with scale=1
-
  command: "{{.QueryNode}}:8093 'select SUM(rating) from default where rating > 100'"
-
  command: "{{.QueryNode}}:8093 'select SUM(rating) from default where rating < 900'"
-
  concurrency: 1  # only 1 instance of delete queries running
  command: "{{.QueryNode}}:8093 'delete from default where rating < 300'"
-
  command: "{{.QueryNode}}:8093 'delete from default where rating > 700'"
-
  command: "{{.QueryNode}}:8093 'delete from default where rating > 300 and rating < 700'"

###############  create views ################
-
  requires: "{{ eq true .DoOnce}}"
  image: sequoiatools/gideon
  entrypoint: "./addviews.sh"
  command: "{{.Orchestrator}}:8092 {{.Bucket}}"
  wait: true

###############  query views ################
-
  concurrency: "{{.Scale 1}}"
  duration: "{{.Scale 60}}"
  command: "query --host {{.Orchestrator}} --ddoc scale --view stats"
-
  command: "query --host {{.Orchestrator}} --ddoc scale --view padd"
-
  command: "query --host {{.Orchestrator}} --ddoc scale --view array"



###############  update data ################
- 
  image: sequoiatools/pillowfight
  command: "-U  {{.Orchestrator}} -I {{.Scale 100000}} -B 100 -t 1  --rate-limit 10000"
  duration: "{{.Scale 60}}"
  wait: true
