-
  # include rebalance and group templates
  include: tests/templates/rebalance.yml, tests/templates/groups.yml
-
   image: sequoiatools/viber
   command: " > LOGS"
   wait: false
-
   image: sequoiatools/cmd
   entrypoint: sleep
   command: "{{.Scale 720}}"
   wait: true
#============ start xdcr replications ============
-
   image: sequoiatools/couchbase-cli
   requires:  "{{eq true .DoOnce }}"
   command:  "xdcr-setup -c {{.Orchestrator}} --create --xdcr-cluster-name remote
        --xdcr-hostname {{.Nodes | .Cluster 1 | net 0}}
        --xdcr-username {{.Nodes | .Cluster 1 | .Attr `rest_username`}}
        --xdcr-password {{.Nodes | .Cluster 1 | .Attr `rest_password`}}"
   wait: true
-
   command: "xdcr-replicate -c {{.Orchestrator}}
        --xdcr-cluster-name remote
        --xdcr-from-bucket {{.Nodes | .Cluster 0 | bucket 0}}
        --xdcr-to-bucket {{.Nodes | .Cluster 1 | bucket 0}}"
   wait: true
-
   command: "xdcr-replicate -c {{.Orchestrator}}
        --xdcr-cluster-name remote
        --xdcr-from-bucket {{.Nodes | .Cluster 0 | bucket 1}}
        --xdcr-to-bucket {{.Nodes | .Cluster 1 | bucket 1}}"
   wait: true
-
   command: "xdcr-replicate -c {{.Orchestrator}}
        --xdcr-cluster-name remote
        --xdcr-from-bucket {{.Nodes | .Cluster 0 | bucket 2}}
        --xdcr-to-bucket {{.Nodes | .Cluster 1 | bucket 2}}"
-
   command: "xdcr-replicate -c {{.Orchestrator}}
        --xdcr-cluster-name remote
        --xdcr-from-bucket {{.Nodes | .Cluster 0 | bucket 3}}
        --xdcr-to-bucket {{.Nodes | .Cluster 1 | bucket 3}}"


#============ rebalance in a node============

-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.NthDataNode 3}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Nodes | .Cluster 1 | net 0}}
       --server-add  {{.Nodes | .Cluster 1 | net 3}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
  template: rebalance
-
  template: rebalance_by_ip
  args: "{{.Nodes | .Cluster 1 | net 0}}"
-
  template: wait_for_rebalance
-
  template: wait_for_rebalance_by_ip
  args: "{{.Nodes | .Cluster 1 | net 0}}"
-
  # failover with delta recovery
  template: failover_and_recover
  args: "{{.Nodes | .Cluster 0 | net 3}}, delta"
  wait: true

-
  # failover with full recovery
  template: failover_and_recover
  args: "{{.NthDataNode 3}}, full"
  wait: true
-
   template: rebalance_out
   args: "{{.NthDataNode 3}}, full"
-
   image: sequoiatools/cmd
   entrypoint: sleep
   command: "{{.Scale 20}}"
   wait: true
-
   image: sequoiatools/couchbase-cli
   command: "rebalance-stop -c {{.Orchestrator}}:8091
        -u {{.RestUsername}} -p  {{.RestPassword}}"
#-
#   image: sequoiatools/couchbase-cli
#   command: "server-add -c  {{.Orchestrator}}
#       --server-add  {{.NthDataNode 3}}
#       -u  {{.RestUsername}} -p  {{.RestPassword}}
#       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
#   wait: true
-
  template: rebalance
-
  template: wait_for_rebalance

#============ rebalance in a node============

-
   image: sequoiatools/couchbase-cli
   command: "rebalance -c  {{.Orchestrator}}
       --server-remove {{.Nodes | .Cluster 0 | net 3}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true
-
   image: sequoiatools/couchbase-cli
   command: "rebalance -c  {{.Nodes | .Cluster 1 | net 0}}
       --server-remove  {{.Nodes | .Cluster 1 | net 3}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true
-
  template: rebalance
-
  template: rebalance_by_ip
  args: "{{.Nodes | .Cluster 1 | net 0}}"
-
  template: wait_for_rebalance
-
  template: wait_for_rebalance_by_ip
  args: "{{.Nodes | .Cluster 1 | net 0}}"


#8 rebalance in 2 nodes on cluster A
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.Nodes | .Cluster 0 | net 3}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.Nodes | .Cluster 1 | net 3}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
  template: rebalance
-
  template: wait_for_rebalance
