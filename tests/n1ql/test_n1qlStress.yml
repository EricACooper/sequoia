-
  include: tests/templates/kv.yml

###############  num slicewriters = 1 ################
-
  image: appropriate/curl
  command: "-v -u Administrator:password -H Content-Type:application/json -X POST
           http://{{.Nodes | .Service `index` | net 0}}:9102/settings -d '{\"indexer.numSliceWriters\" : 1}'"

###############  create indexes ################
-
   image: sequoiatools/cbq
   command: "-e=http://{{.QueryNodePort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_rating on `default`(rating)'"
-
   command: "-e=http://{{.QueryNodePort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_claims on `default`(claim)'"
-
   command: "-e=http://{{.Nodes | .Service `n1ql` | net 1 | noport}}:{{.QueryPort}} -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_result on `default`(result)'"
-
   command: "-e=http://{{.Nodes | .Service `n1ql` | net 1 | noport}}:{{.QueryPort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create primary index on `default`'"
   wait: true

###############  start data loading ################
-
  image: sequoiatools/gideon
  command: "kv --ops {{.Scale 10000}} --create 70 --get 10 --delete 20  --hosts {{.Orchestrator}} --bucket {{.Bucket}}"
  alias: DocLoader
-
  image: sequoiatools/gideon
  command: "kv --ops {{.Scale 20000}} --size 64 --create 100  --hosts {{.Orchestrator}} --bucket {{.Bucket}}"
  alias: SmallDocLoader

# ###############  query both query nodes ################
-
  image: sequoiatools/curloop
  command: "n1ql.sh {{.QueryNodePort}} 'select SUM(rating) from default where rating > 0 limit 50'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'select result from default where result = SUCCESS limit 50'"
-
  command: "n1ql.sh {{.Nodes | .Service `n1ql` | net 1 | noport}}:{{.QueryPort}} 'select claim from default where claim like A% limit 20'"
-
  command: "n1ql.sh {{.Nodes | .Service `n1ql` | net 1 | noport}}:{{.QueryPort}} 'select * from default where rating < 100  limit 20'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'delete from default where rating < 300'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'delete from default where rating > 700'"
-
  command: "n1ql.sh {{.Nodes | .Service `n1ql` | net 1 | noport}}:{{.QueryPort}} 'delete from default where rating > 300 and rating < 700'"


### until 100M items ######
-
   template: wait_for_items
   args: "{{.Bucket}}, 100000000"
-
   client:
     op: rm
     container: DocLoader
-
   client:
     op: rm
     container: SmallDocLoader
