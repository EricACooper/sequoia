-
  include: tests/templates/kv.yml


###############  create indexes ################
-
   image: sequoiatools/cbq
   command: "-e=http://{{.QueryNodePort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_rating on `default`(rating)'"
-
   command: "-e=http://{{.QueryNodePort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_claims on `default`(claim)'"
-
   command: "-e=http://{{.QueryNodePort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_result on `default`(result)'"
-
   command: "-e=http://{{.QueryNodePort}}  -u={{.RestUsername}} -p={{.RestPassword}} -script='create primary index on `default`'"
   wait: true

###############  start data loading ################
-
  image: sequoiatools/gideon
  command: "kv --ops {{.Scale 10000}} --create 70 --get 10 --delete 20  --hosts {{.Orchestrator}} --bucket {{.Bucket}}"
  alias: DocLoader

# ###############  query index ################
-
  image: sequoiatools/curloop
  command: "n1ql.sh {{.QueryNodePort}} 'select SUM(rating) from default where rating > 0 limit 50'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'select result from default where result = SUCCESS limit 50'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'select claim from default where claim like A% limit 20'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'select * from default where rating < 100  limit 20'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'delete from default where rating < 300'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'delete from default where rating > 700'"
-
  command: "n1ql.sh {{.QueryNodePort}} 'delete from default where rating > 300 and rating < 700'"


### until 100M items ######
-
   template: wait_for_items
   args: "{{.Bucket}}, 100000000"
-
   client:
     op: rm
     container: DocLoader

