---
#============ initial bucket flushing  ============
- 
    image: couchbase-cli
    command:  "bucket-flush -c $address(0,0) --force --bucket $bucket(0,0)"
    wait: true
- 
    command:  "bucket-flush -c $address(0,0) --force --bucket $bucket(1,0)"
    wait: true

#============ continous kv loading a minimum of 15M items  ============
- 
   image: pillowfight
   command: "-U  $address(0,0) -I 10000 -t 1 -c 100"
- 
   command: "-U  $address(0,0)/$bucket(1,0) -p bbb -I 10000 -t 1 -c 100"
   wait: true

#============ start view queries  ============
- 
   image: gideon
   command: "kv --ops 5000 --create 30 --get 70 --delete 10 --expire 20 --ttl 600  --hosts $address(0,1) --bucket  $bucket(0,0) --sizes 16000"

- 
   image: gideon
   entrypoint: "./addviews.sh"
   command: "$address(0,0):8092 $bucket(1,0)"
   wait: true
- 
   command: "query --host $address(0,0) --ddoc scale --view stats --concurrency 10"
- 
   command: "query --host $address(0,0) --ddoc scale --view padd --concurrency 10"
- 
   command: "query --host $address(0,0) --ddoc scale --view array --concurrency 10"


#============ start xdcr replications ============
- 
     image: couchbase-cli
     command:  'xdcr-setup -c  $address(0,0) --create
                      --xdcr-cluster-name $attr(0, name)
                      --xdcr-hostname $address(1,0)
                      --xdcr-username $attr(1, rest_username)
                      --xdcr-password $attr(1, rest_password)'
     wait: true
- 
     command: 'xdcr-replicate -c $address(0,0)
                      --xdcr-cluster-name $attr(0, name) 
                      --xdcr-from-bucket $bucket(0,0) 
                      --xdcr-to-bucket $bucket(0,0)'
     wait: true

#============ rebalance out a node============
- 
    image: couchbase-cli
    command:  "rebalance -c  $address(0,0)
               --server-remove $address(0,1)
               -u  $attr(0, rest_username) -p  $attr(0, rest_password)"
    wait: true

