---
flush:
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket CUSTOMER"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket DISTRICT"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket HISTORY"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket ITEM"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket ORDERS"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket NEW_ORDER"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket ORDER_LINE"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket STOCK"
  - test:
      container: couchbase-cli
      command:  "bucket-flush -c servers:address:0:0 --force --bucket WAREHOUSE"


kv:  # continous kv loading up to 200M items
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -M 512 -p aaa -I 50000000 -t 4 -B 100 --rate-limit 1000"
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -M 128 -p bbb -I 50000000 -t 4 -B 100 --rate-limit 1000"
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -M 356 -p ccc -I 50000000 -t 4 -B 100 --rate-limit 1000"
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -M 1024 -p ddd -I 50000000 -t 4 -B 100 --rate-limit 1000"
  - test:
     container: gideon
     command: "kv --ops 5000 --create 30 --get 70 --delete 10 --expire 20 --ttl 600  --hosts servers:address:0:0 --bucket  default --sizes 16000"


query:
  - test:
     container: gideon
     entrypoint: "./addviews.sh"
     command: "servers:address:0:0:8092 default"
     wait: true
  - test:
     container: gideon
     command: "query --host servers:address:0:0 --ddoc scale --view stats --concurrency 10"
  - test:
     container: gideon
     command: "query --host servers:address:0:0 --ddoc scale --view padd --concurrency 10"
  - test:
     container: gideon
     command: "query --host servers:address:0:0 --ddoc scale --view array --concurrency 10"
  - test:
     container: gideon
     command: "query --host servers:address:0:0 --ddoc scale --view custom --concurrency 10"


index:
  - test:  # run background tpcc 
       container: tpcc
       command:  "./run.sh servers:address:0:7:8093 util/cbcrindex.sql"
       wait: true 
  - test:
        container: tpcc
        command: "python tpcc.py --duration 259200 --client 10 --warehouses 100 --no-execute n1ql 
                                 --query-url servers:address:0:7:8093 
                                 --userid Administrator --password password"
        wait: false 
  - test:
        container: tpcc
        command: "python tpcc.py --duration 2259200 --client 10 --warehouses 100
                                 --no-load n1ql  --query-url servers:address:0:7:8093
                                 --userid Administrator --password password"

kv2:
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true

reb_out:  # rebalance out a node 
  - test:
       container: couchbase-cli
       command:  "rebalance -c  servers:address:0:0
                  --server-remove servers:address:0:1
                  -u  servers:rest_username:0 -p  servers:rest_password:0"
       wait: true

kv3:
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true

xdcr:  # start xdcr
  - test:
       container: couchbase-cli
       command:  'xdcr-setup -c  servers:address:0:0 --create
                        --xdcr-cluster-name servers:clustername:0
                        --xdcr-hostname servers:address:1:0
                        --xdcr-username servers:rest_username:1
                        --xdcr-password servers:rest_password:1'
       wait: true
  - test:
       container: couchbase-cli
       command: 'xdcr-replicate -c servers:address:0:0 
                        --xdcr-cluster-name servers:clustername:0 
                        --xdcr-from-bucket default
                        --xdcr-to-bucket default'
       wait: true

kv4:
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true


swap_rebalance:
  - test:
       container: couchbase-cli
       command: "server-add -c  servers:address:0:0
                 --server-add  servers:address:0:1
                 -u  servers:rest_username:0 -p  servers:rest_password:0
                 --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
       wait: true
  - test:
       container: couchbase-cli
       command:  "rebalance -c  servers:address:0:0
                    --server-remove servers:address:0:2
                    -u  servers:rest_username:0 -p  servers:rest_password:0"
           wait: true

kv5:
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true


swap_failover:
      - test:
           container: couchbase-cli
           command: "server-add -c  servers:address:0:0
                     --server-add  servers:address:0:2
                     -u  servers:rest_username:0 -p  servers:rest_password:0
                     --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
           wait: true
      - test:
          container: couchbase-cli
          command: "failover -c servers:address:0:0 
                    --server-failover servers:address:0:1
                    -u  servers:rest_username:0 -p  servers:rest_password:0"
          wait: true
      - test:
           container: couchbase-cli
           command:  "rebalance -c  servers:address:0:0
                        -u  servers:rest_username:0 -p  servers:rest_password:0"
           wait: true
kv6:
  - test:
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true


add_back:
      - test:
           container: couchbase-cli
           command: "server-add -c  servers:address:0:0
                     --server-add  servers:address:0:1
                     -u  servers:rest_username:0 -p  servers:rest_password:0
                     --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
           wait: true
      - test:
           container: couchbase-cli
           command:  "rebalance -c  servers:address:0:0
                        -u  servers:rest_username:0 -p  servers:rest_password:0"
           wait: true
