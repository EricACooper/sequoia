---

#============ initial bucket flushing  ============
- 
    container: couchbase-cli
    command:  "bucket-flush -c servers:address:0:0 --force --bucket CUSTOMER"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket DISTRICT"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket HISTORY"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket ITEM"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket ORDERS"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket NEW_ORDER"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket ORDER_LINE"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket STOCK"
- 
    command:  "bucket-flush -c servers:address:0:0 --force --bucket WAREHOUSE"

#============ continous kv loading a minimum of 15M items  ============
- 
   container: pillowfight
   command: "-U servers:address:0:0 -M 512 -p aaa -I 5000000 -t 4 -B 100 --rate-limit 1000"
- 
   command: "-U servers:address:0:0 -M 128 -p bbb -I 5000000 -t 4 -B 100 --rate-limit 1000"
- 
   command: "-U servers:address:0:0 -M 356 -p ccc -I 5000000 -t 4 -B 100 --rate-limit 1000"
- 
   container: gideon
   command: "kv --ops 5000 --create 30 --get 70 --delete 10 --expire 20 --ttl 600  --hosts servers:address:0:0 --bucket  default --sizes 16000"

#============  view queries ============
- 
   container: gideon
   entrypoint: "./addviews.sh"
   command: "servers:address:0:0:8092 default"
   wait: true
- 
   container: gideon
   command: "query --host servers:address:0:0 --ddoc scale --view stats --concurrency 10"
- 
   container: gideon
   command: "query --host servers:address:0:0 --ddoc scale --view padd --concurrency 10"
- 
   container: gideon
   command: "query --host servers:address:0:0 --ddoc scale --view array --concurrency 10"
- 
   container: gideon
   command: "query --host servers:address:0:0 --ddoc scale --view custom --concurrency 10"


#============  tpcc ============
- 
     container: tpcc
     command:  "./run.sh servers:address:0:7:8093 util/cbcrindex.sql"
     wait: true 
- 
      container: tpcc
      command: "python tpcc.py --duration 259200 --client 10 --warehouses 50 --no-execute n1ql 
                               --query-url servers:address:0:7:8093 
                               --userid Administrator --password password"
      wait: false 
- 
      container: tpcc
      command: "python tpcc.py --duration 2259200 --client 10 --warehouses 50 
                               --no-load n1ql  --query-url servers:address:0:7:8093
                                 --userid Administrator --password password"

#  kv buffer 
- 
   container: pillowfight
   command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
   wait: true

# rebalance out a node 
- 
     container: couchbase-cli
     command:  "rebalance -c  servers:address:0:0
                --server-remove servers:address:0:1
                -u  servers:rest_username:0 -p  servers:rest_password:0"
     wait: true

#  kv buffer 
- 
   container: pillowfight
   command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
   wait: true

# start xdcr
- 
     container: couchbase-cli
     command:  'xdcr-setup -c  servers:address:0:0 --create
                      --xdcr-cluster-name servers:clustername:0
                      --xdcr-hostname servers:address:1:0
                      --xdcr-username servers:rest_username:1
                      --xdcr-password servers:rest_password:1'
     wait: true
- 
     container: couchbase-cli
     command: 'xdcr-replicate -c servers:address:0:0 
                      --xdcr-cluster-name servers:clustername:0 
                      --xdcr-from-bucket default
                      --xdcr-to-bucket remote'
     wait: true

# kv4
- 
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true


# swap_rebalance
- 
     container: couchbase-cli
     command: "server-add -c  servers:address:0:0
               --server-add  servers:address:0:1
               -u  servers:rest_username:0 -p  servers:rest_password:0
               --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
     wait: true
- 
     container: couchbase-cli
     command:  "rebalance -c  servers:address:0:0
                  --server-remove servers:address:0:2
                  -u  servers:rest_username:0 -p  servers:rest_password:0"
     wait: true

# kv5
- 
     container: pillowfight
     command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
     wait: true


# swap_failover:
- 
    container: couchbase-cli
    command: "server-add -c  servers:address:0:0
              --server-add  servers:address:0:2
              -u  servers:rest_username:0 -p  servers:rest_password:0
              --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
    wait: true
- 
    container: couchbase-cli
    command: "failover -c servers:address:0:0 
              --server-failover servers:address:0:1
              -u  servers:rest_username:0 -p  servers:rest_password:0"
    wait: true
- 
    container: couchbase-cli
    command:  "rebalance -c  servers:address:0:0
                 -u  servers:rest_username:0 -p  servers:rest_password:0"
    wait: true

#kv6:
- 
   container: pillowfight
   command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
   wait: true

# swap_hard_failover:
- 
     container: couchbase-cli  # as indexer
     command: "server-add -c  servers:address:0:0
               --server-add  servers:address:0:1
               --services index
               -u  servers:rest_username:0 -p  servers:rest_password:0
               --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
     wait: true
- 
    container: couchbase-cli
    command: "failover -c servers:address:0:0 
              --server-failover servers:address:0:2
              -u  servers:rest_username:0 -p  servers:rest_password:0 --force"
    wait: true
- 
    container: couchbase-cli
    command: "failover -c servers:address:0:0 
              --server-failover servers:address:0:3
              -u  servers:rest_username:0 -p  servers:rest_password:0 --force"
    wait: true
- 
     container: couchbase-cli
     command:  "rebalance -c  servers:address:0:0
                  -u  servers:rest_username:0 -p  servers:rest_password:0"
     wait: true

# kv7:
- 
   container: pillowfight
   command: "-U servers:address:0:0 -I 1000000 -t 4 -B 250 -c 1000"
   wait: true


# add_back:
- 
     container: couchbase-cli
     command: "server-add -c  servers:address:0:0
               --server-add  servers:address:0:2
               -u  servers:rest_username:0 -p  servers:rest_password:0
               --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
     wait: true
- 
     container: couchbase-cli
     command: "server-add -c  servers:address:0:0
               --server-add  servers:address:0:3
               -u  servers:rest_username:0 -p  servers:rest_password:0
               --server-add-username servers:rest_username:0 --server-add-password  servers:rest_password:0"
     wait: true
- 
     container: couchbase-cli
     command:  "rebalance -c  servers:address:0:0
                  -u  servers:rest_username:0 -p  servers:rest_password:0"
     wait: true
