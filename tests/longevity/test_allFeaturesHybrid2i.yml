---
#============ continous kv loading a minimum of 150K items when Scale=1 ============
-
   image: sequoiatools/pillowfight
   command: "-U {{.Orchestrator}} -M 512 -I {{.Scale 2000}} -B {{.Scale 200}} -t 4  --rate-limit {{.Scale 2000}}"
-
   image: sequoiatools/gideon
   command: "kv --ops {{.Scale 500}} --create 15 --get 80 --delete 5  --hosts {{.Orchestrator}} --bucket {{.Bucket}} --sizes 512 128 1024"
-
   command: "kv --ops {{.Scale 100}} --create 10 --get 90 --expire 100 --ttl 660  --hosts {{.Orchestrator}} --bucket {{.Bucket}}"


#============ start tpcc indexing  ============
-
   image: sequoiatools/tpcc
   requires:  "{{.Version | le 4.0}}"
   command:  "./run.sh {{.QueryNode}}:8093 util/cbcrindex.sql"
   wait: true
-
   image: sequoiatools/tpcc
   requires:  "{{.Version | le 4.0}}"
   command: "python tpcc.py --duration 259200 --client 5 --warehouses 5 --no-execute n1ql
						    --query-url {{.QueryNode}}:8093 --userid {{.RestUsername}} --password {{.RestPassword}}"
-
   requires:  "{{.Version | le 4.0}}"
   command: "python tpcc.py --duration 2259200 --client 5 
			     --warehouses 5 --no-load n1ql  --query-url {{.QueryNode}}:8093"
-
   image: sequoiatools/cbq
   requires:  "{{.Version | le 4.0 | eq .DoOnce }}"
   command: "-e=http://{{.QueryNode}}:8093  -u={{.RestUsername}} -p={{.RestPassword}} -script='create index default_rating on `default`(rating)'"



#============ start view queries  ============
-
   image: sequoiatools/gideon
   entrypoint: "./addviews.sh"
   command: "{{.Orchestrator}}:8092 {{.Bucket}}"
   wait: true
-
   command: "query --host {{.Orchestrator}} --ddoc scale --view stats --concurrency {{.Scale 1}}"
-
   command: "query --host {{.NthDataNode 4}} --ddoc scale --view padd --concurrency {{.Scale 1}}"
-
   command: "query --host {{.NthDataNode 5}} --ddoc scale --view array --concurrency {{.Scale 1}}"


#============ quick update batch ============
-
   image: sequoiatools/pillowfight
   command: "-U  {{.Orchestrator}} -I {{.Scale 1000}} -B {{.Scale 100}} -t 4 -c 10"
   wait: true

#============ rebalance out a node============
-
    image: sequoiatools/couchbase-cli
    command:  "rebalance -c  {{.Orchestrator}} --server-remove {{.ClusterNodes | net 1}}  -u  {{.RestUsername}} -p  {{.RestPassword}}"
    wait: true

#============ start xdcr replications ============
-
   image: sequoiatools/couchbase-cli
   requires:  "{{eq true .DoOnce }}"
   command:  "xdcr-setup -c {{.Orchestrator}} --create --xdcr-cluster-name remote 
	--xdcr-hostname {{.Nodes | .Cluster 1 | net 0}}
	--xdcr-username {{.Nodes | .Cluster 1 | .Attr `rest_username`}} 
	--xdcr-password {{.Nodes | .Cluster 1 | .Attr `rest_password`}}"
   wait: true
-
   command: "xdcr-replicate -c {{.Orchestrator}}
	--xdcr-cluster-name remote 
	--xdcr-from-bucket ORDER_LINE 
	--xdcr-to-bucket {{.Nodes | .Cluster 1 | bucket 0}}"
   wait: true

#============ quick update batch ============
-
   image: sequoiatools/pillowfight
   command: "-U  {{.Orchestrator}} -I {{.Scale 1000}} -B {{.Scale 100}} -t 4 -c 10"
   wait: true


#============ swap rebalance ============
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}} 
       --server-add {{.ClusterNodes | net 1}} 
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   command:  "rebalance -c  {{.Orchestrator}}
    --server-remove {{.ClusterNodes | net 2}}
    -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true

#============ quick update batch ============
-
   image: sequoiatools/pillowfight
   command: "-U  {{.Orchestrator}} -I {{.Scale 1000}} -B {{.Scale 100}} -t 4 -c 10"
   wait: true


#============ swap failover ============
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.ClusterNodes | net 2}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   command: "failover -c {{.Orchestrator}}
       --server-failover {{.ClusterNodes | net 1}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true
-
   command:  "rebalance -c  {{.Orchestrator}} -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true


#============ remote remove ============
-
    image: sequoiatools/couchbase-cli
    command:  "rebalance -c  {{.Nodes | .Cluster 1 | net 0}} --server-remove {{.Nodes | .Cluster 1 | net 1}}  -u  {{.RestUsername}} -p  {{.RestPassword}}"


#============ quick update batch ============
-
   image: sequoiatools/pillowfight
   command: "-U  {{.Orchestrator}} -I {{.Scale 1000}} -B {{.Scale 100}} -t 4 -c 10"
   wait: true


#============ swap hard failover index node ============
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.ClusterNodes | net 1}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   command: "failover -c {{.Orchestrator}}
      --server-failover {{.ClusterNodes | net 2}}
      -u  {{.RestUsername}} -p  {{.RestPassword}} --force"
   wait: true
-
   command: "failover -c {{.Orchestrator}}
      --server-failover {{.Nodes | .Service `index` | net 0}}
      -u  {{.RestUsername}} -p  {{.RestPassword}} --force"
   wait: true
-
   command:  "rebalance -c  {{.Orchestrator}} -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true

#============ quick update batch ============
-
   image: sequoiatools/pillowfight
   command: "-U  {{.Orchestrator}} -I {{.Scale 1000}} -B {{.Scale 100}} -t 4 -c 10"
   wait: true

#============ bi-xdcr to recover lost data =======
-
   image: sequoiatools/couchbase-cli
   requires:  "{{eq true .DoOnce }}"
   command:  "xdcr-setup -c {{.Nodes | .Cluster 1 | net 0}} --create --xdcr-cluster-name local 
        --xdcr-hostname {{.Orchestrator}}
        --xdcr-username {{.RestUsername}} 
        --xdcr-password {{.RestPassword}}"
   wait: true
-
   command: "xdcr-replicate -c {{.Nodes | .Cluster 1 | net 0}}
        --xdcr-cluster-name local 
        --xdcr-from-bucket {{.Nodes | .Cluster 1 | bucket 0}}
        --xdcr-to-bucket ORDER_LINE"
   wait: true

#============ quick update batch ============
-
   image: sequoiatools/pillowfight
   command: "-U  {{.Orchestrator}} -I {{.Scale 1000}} -B {{.Scale 100}} -t 4 -c 10"
   wait: true

#============ add back============
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.ClusterNodes | net 2}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   command: "server-add -c  {{.Orchestrator}}
       --server-add  {{.Nodes | .Service `index` | net 0}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   command:  "rebalance -c  {{.Orchestrator}} -u  {{.RestUsername}} -p  {{.RestPassword}}"
   wait: true

#============ remote add back============
-
   image: sequoiatools/couchbase-cli
   command: "server-add -c  {{.Nodes | .Cluster 1 | net 0}}
       --server-add  {{.Nodes | .Cluster 1 | net 1}}
       -u  {{.RestUsername}} -p  {{.RestPassword}}
       --server-add-username {{.RestUsername}} --server-add-password  {{.RestPassword}}"
   wait: true
-
   command:  "rebalance -c  {{.Nodes | .Cluster 1 | net 0}} -u  {{.RestUsername}} -p  {{.RestPassword}}"
